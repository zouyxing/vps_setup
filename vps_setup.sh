expect << 'EOF'
set timeout 300
spawn bash /root/Xray-script.sh

# ------------------------------
# ① 检查是否有更新
# ------------------------------
expect {
    -re {是否更新.*} {
        puts "检测到可更新 → 自动发送 Y"
        send "Y\r"
        exp_continue
    }
    timeout {
        puts "未检测到更新提示 → 继续安装"
    }
}

# ------------------------------
# ② 主菜单：完整安装 → 输入 1
# ------------------------------
expect {
    -re {请选择操作} {
        puts "主菜单出现 → 选择 1 (完整安装)"
        send "1\r"
    }
    "*请选择*" {
        puts "模糊匹配主菜单 → 选择 1"
        send "1\r"
    }
    timeout {
        puts "主菜单匹配失败"; exit 1
    }
}

# ------------------------------
# ③ 安装流程：自定义配置 → 输入 2
# ------------------------------
expect {
    -re {请选择操作} {
        puts "安装流程菜单 → 选择 2 (自定义配置)"
        send "2\r"
    }
    "*请选择*" { send "2\r" }
    timeout { puts "安装流程匹配失败"; exit 1 }
}

# ------------------------------
# ④ 装载管理：稳定版 → 输入 2
# ------------------------------
expect {
    -re {请选择操作} {
        puts "装载管理菜单 → 选择 2 (稳定版)"
        send "2\r"
    }
    "*请选择*" { send "2\r" }
    timeout { puts "装载管理匹配失败"; exit 1 }
}

# ------------------------------
# ⑤ 可选配置：VLESS+Vision+REALITY → 输入 2
# ------------------------------
expect {
    -re {请选择操作} {
        puts "可选配置菜单 → 选择 2 (VLESS+Vision+REALITY)"
        send "2\r"
    }
    "*请选择*" { send "2\r" }
    timeout { puts "可选配置匹配失败"; exit 1 }
}

# ------------------------------
# ⑥ 是否重置路由规则 → 输入 n
# ------------------------------
expect {
    -re {是否重置路由规则} {
        puts "不重置路由规则 → 输入 n"
        send "n\r"
    }
    timeout { puts "等待路由规则重置提示失败"; exit 1 }
}

# ------------------------------
# ⑦ 端口 → 输入 38626
# ------------------------------
expect {
    -re {请输入 port} {
        puts "设置端口为 38626"
        send "38626\r"
    }
    timeout { puts "端口输入失败"; exit 1 }
}

# ------------------------------
# ⑧ UUID → 默认自动生成
# ------------------------------
expect {
    -re {请输入 UUID} {
        puts "UUID 自动生成"
        send "\r"
    }
    timeout { puts "UUID 输入失败"; exit 1 }
}

# ------------------------------
# ⑨ target → 默认
# ------------------------------
expect {
    -re {请输入目标域名} {
        puts "目标域名自动选择"
        send "\r"
    }
    timeout { puts "目标域名输入失败"; exit 1 }
}

# ------------------------------
# ⑩ shortId → 默认
# ------------------------------
expect {
    -re {请输入 shortId} {
        puts "shortId 自动生成"
        send "\r"
    }
    timeout { puts "shortId 输入失败"; exit 1 }
}

# ------------------------------
# 结束
# ------------------------------
expect {
    eof { puts "Xray 安装配置完成" }
    timeout { puts "安装过程超时"; exit 1 }
}
EOF

